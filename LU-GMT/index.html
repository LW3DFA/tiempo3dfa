<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>RELOJ & TIEMPO by LW3DFA</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">

  <!-- Acomoda la pantalla para celular o tablet  -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
  
  /* üåå Fondo y fuente base */
  body {
    margin: 0;
    padding: 0;
    font-family: 'Roboto', sans-serif;
    background: #000 url('fondoLW3.jpg') no-repeat center center;
    background-size: cover;
    color: #00ffff;
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
  }

  /* üì¶ Contenedor central */
  .contenedor {
    width: 90vw;
    max-width: 600px;
    padding: 15px;
    text-align: center;
   /* background-color: rgba(0, 0, 0, 0.6); /* semitransparente para contraste */
    border-radius: 10px;
  }

  /* üñãÔ∏è Estilos de texto */
  .titulo {
    font-size: 4em;
    margin-bottom: 2px;
     color: #66E44C;
    text-shadow: 2px -2px 3px #FFFFFF;
  }

  .fecha {
    font-size: 1.5em;
    color: #ffffff;
    margin-bottom: 6px;
  }

  .clock {
    font-size: 2.5em;
    margin: 6px 0;
  }

  .temp {
    font-size: 2em;
    color: #ffa500;
    margin-top: 6px;
  }

  .clima {
    font-size: 1.5em;
    color: #66E44C;
    margin-top: 6px;
  }

  .viento {
    font-size: 1.5em;
    color: #00bfff;
    margin-top: 6px;
  }

  /* üì± Responsive para modo apaisado */
  @media screen and (orientation: landscape) {
    .contenedor {
      max-width: 80vw;
      padding: 30px;
    }

    .titulo {
      font-size: 3em;
    }

    .clock, .temp, .clima, .viento {
      font-size: 2em;
    }
  }
</style>

</head>

<body>
    <div class="contenedor">
    <h3>Estado Multi GADTM</h3>
    <p id="multimodo">Multimodo: cargando...</p>  
  <!-- <div class="titulo">ONLINE</div> -->
    <div class="fecha" id="fecha"></div>
    <div class="clock" id="localClock"></div>
    <div class="clock" id="utcClock"></div>
    <div class="temp" id="temp">Cargando temperatura...</div>
    <div class="clima" id="descripcion">
      <img id="iconoClima" src="" alt="Icono clima" style="vertical-align: middle; height: 60px;">
      <span id="textoClima">Cargando clima...</span>
    </div>
    <div class="viento" id="viento">Cargando viento...</div>
  </div>
</body>

<script>
 // Monitoreo Multiprotocolo
 async function actualizarEstado() {
      try {
        const resp = await fetch("/.netlify/functions/estado");
        const data = await resp.json();
        let texto = `Multimodo: ${data.estado}`;
        if (data.temp !== null) {
          texto += ` (${data.temp}¬∞C)`;
        }
        if (data.fecha) {
          texto += ` - √öltimo env√≠o: ${new Date(data.fecha).toLocaleString()}`;
        }
        document.getElementById("multimodo").innerText = texto;
      } catch {
        document.getElementById("multimodo").innerText = "Error consultando estado";
      }
    }

  actualizarEstado();
  setInterval(actualizarEstado, 300000); // refresca cada 5 min
	
// Variables globales de viento y d√≠a actual
let diaActual = new Date().getDate();
let vientoVelocidad = "";
let vientoDireccion = "";
let mostrarVelocidad = true;

// üß≠ Matriz de 16 puntos cardinales aprox.
const direcciones = [
  { nombre: "N",     desde: 348.75, hasta: 11.25 },
  { nombre: "NNE",   desde: 11.25,  hasta: 33.75 },
  { nombre: "NE",    desde: 33.75,  hasta: 56.25 },
  { nombre: "ENE",   desde: 56.25,  hasta: 78.75 },
  { nombre: "E",     desde: 78.75,  hasta: 101.25 },
  { nombre: "ESE",   desde: 101.25, hasta: 123.75 },
  { nombre: "SE",    desde: 123.75, hasta: 146.25 },
  { nombre: "SSE",   desde: 146.25, hasta: 168.75 },
  { nombre: "S",     desde: 168.75, hasta: 191.25 },
  { nombre: "SSO",   desde: 191.25, hasta: 213.75 },
  { nombre: "SO",    desde: 213.75, hasta: 236.25 },
  { nombre: "OSO",   desde: 236.25, hasta: 258.75 },
  { nombre: "O",     desde: 258.75, hasta: 281.25 },
  { nombre: "ONO",   desde: 281.25, hasta: 303.75 },
  { nombre: "NO",    desde: 303.75, hasta: 326.25 },
  { nombre: "NNO",   desde: 326.25, hasta: 348.75 }
];


// üîÑ Convierte grados a direcci√≥n cardinal
function obtenerDireccionCardinal(grados) {
  for (let dir of direcciones) {
    if (dir.desde > dir.hasta) {
      // Rango que cruza el 0¬∞ (ej. N)
      if (grados >= dir.desde || grados < dir.hasta) return dir.nombre;
    } else {
      if (grados >= dir.desde && grados < dir.hasta) return dir.nombre;
    }
  }
  return "Desconocido";
}

// üóìÔ∏è Actualiza la fecha si cambia el d√≠a
function verificarCambioDeDia() {
  let ahora = new Date();
  if (ahora.getDate() !== diaActual) {
    diaActual = ahora.getDate();
    updateFecha();
  }
}

// üóìÔ∏è Muestra la fecha formateada en espa√±ol
function updateFecha() {
  let now = new Date();
  let opciones = {
    weekday: 'long',
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  };
  let fechaFormateada = now.toLocaleDateString('es-AR', opciones);
  document.getElementById("fecha").textContent =
    fechaFormateada.charAt(0).toUpperCase() + fechaFormateada.slice(1);
}

// ‚è∞ Actualiza los relojes LU y UTC cada segundo
function updateClocks() {
  let now = new Date();
  document.getElementById("localClock").textContent =
    "LU: " + now.toLocaleTimeString('es-AR', { hour12: false });
  document.getElementById("utcClock").textContent =
    "UTC: " + now.toUTCString().split(" ")[4];
}

// üå°Ô∏è Obtiene datos del clima desde OpenWeather y actualiza pantalla
async function updateTemp() {
  let apiKey = "6af85f92a202ebffb3cedcb4b45ad4e8";
  let city = "Buenos Aires,AR";
  let url = `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${apiKey}&units=metric&lang=es`;

  try {
    let res = await fetch(url);
    let data = await res.json();

    // Icono y descripci√≥n del clima
    let descripcion = data.weather[0].description;
    let iconCode = data.weather[0].icon;
    let iconUrl = `https://openweathermap.org/img/wn/${iconCode}@2x.png`;

    document.getElementById("iconoClima").src = iconUrl;
    document.getElementById("textoClima").textContent =
      descripcion.charAt(0).toUpperCase() + descripcion.slice(1);

    // Temperatura y sensaci√≥n t√©rmica
    document.getElementById("temp").textContent =
      `Temp: ${data.main.temp.toFixed(1)} ¬∞C.
      Sensaci√≥n: ${data.main.feels_like.toFixed(1)} ¬∞C`;

    
	// Guardamos datos de viento para alternar
        // Guardamos datos de viento para alternar
    vientoVelocidad = (data.wind.speed * 3.6).toFixed(2); // km/h
    vientoDireccion = data.wind.deg;

  } catch (e) {
    document.getElementById("temp").textContent = "Error al cargar";
    document.getElementById("textoClima").textContent = "Error al cargar clima";
  }
}

// üå¨Ô∏è Alterna entre velocidad y direcci√≥n del viento
function alternarViento() {
  const direccionCardinal = obtenerDireccionCardinal(vientoDireccion);
  document.getElementById("viento").textContent =
    `Viento: (${direccionCardinal}) a ${vientoVelocidad} km/h`;
}


// üß† Inicializaci√≥n
updateFecha();
updateClocks();
updateTemp();
alternarViento(); // primera visualizaci√≥n

// ‚è±Ô∏è Timers
setInterval(updateClocks, 1000);             // reloj cada segundo
setInterval(updateTemp, 600000);             // clima cada 10 minutos
setInterval(verificarCambioDeDia, 600000);   // fecha cada 10 minutos
setInterval(alternarViento, 30000);          // viento cada 10 segundos
</script>
</body>
</html>
